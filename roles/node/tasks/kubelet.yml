---
- file: path="{{A_k8s_hostdir}}" state=absent

- file: path="{{item}}" state=directory mode=0755
  with_items:
    - "{{A_k8s_etc_hostdir}}"
    - "{{A_k8s_pki_hostdir}}"


- file: path="{{item}}" state=directory mode=0755
  with_items:
    - "{{cni_bin_dir}}"
    - "{{cni_etc_dir}}"

- name: config kubelet bootstrap kubeconfig
  copy:
    src: "{{dpy_kcf_dir}}/{{AA_bsp_kcf}}"
    dest: "{{A_k8s_etc_hostdir}}/{{AA_bsp_kcf}}"

- name: config kubelet.service
  template:
    src: kubelet.service.j2
    dest: /usr/lib/systemd/system/kubelet.service

- name: start kubelet
  systemd:
    name: kubelet
    state: restarted
    daemon_reload: yes